"use strict";
var Promise = require("bluebird");
var child_process_1 = require("child_process");
var _ = require("lodash");
function checkstack(hostNodes) {
    var stacks = [];
    _.map(hostNodes, function (container) {
        var compose_label = container.Config.Labels["com.docker.compose.project"];
        var exists = false;
        _.map(stacks, function (stack) {
            if (compose_label === stack.label) {
                exists = true;
                stack.containers.push(container);
            }
        });
        if (!exists) {
            stacks.push({ label: compose_label, containers: [container] });
        }
    });
    return stacks;
}
function getData() {
    return new Promise(function (resolve, reject) {
        child_process_1.exec("docker ps | grep -c ''", function (err, stdout, stderr) {
            if (err) {
                reject(err);
            }
            else if (stdout && parseInt(stdout) && parseInt(stdout) > 1) {
                console.log(parseInt(stdout));
                child_process_1.exec("docker inspect $(docker ps | awk '{print$1}'|grep -v CONTAINER)", function (err, stdout, stderr) {
                    if (err) {
                        console.log(err);
                    }
                    else if (stdout) {
                        var DockerContainers = JSON.parse(stdout);
                        resolve({
                            containers: DockerContainers,
                            stacks: checkstack(DockerContainers)
                        });
                    }
                    else {
                        reject("malformed json docker logs");
                    }
                });
            }
            else if (stdout && parseInt(stdout) && parseInt(stdout) === 1) {
                resolve({
                    containers: [],
                    stacks: []
                });
            }
            else {
                reject("malformed answer");
            }
        });
    });
}
var Dockerlogs = (function () {
    function Dockerlogs(conf) {
        this.apiVersion = require("./package.json").version;
        this.dockerVersion = child_process_1.execSync("docker -v | grep version | awk '{print$3}' | sed 's/,//g'").toString("utf-8").replace('\n', '');
        this.composeVersion = child_process_1.execSync("docker-compose -v | grep compose | awk '{print$3}' | sed 's/,//g'").toString("utf-8").replace('\n', '');
        var configuration = {};
        if (conf) {
            Object['assign'](configuration, conf);
        }
        this.options = configuration;
    }
    Dockerlogs.prototype.data = function (options) {
        var opt;
        if (options) {
        }
        else {
        }
        return getData();
    };
    Dockerlogs.prototype.stream = function (cb, options) {
        var that = this;
        function doit() {
            that.data().then(function (data) {
                cb(data);
            });
        }
        if (options) {
        }
        else {
        }
        setInterval(function () {
            doit();
        }, 5000);
        doit();
    };
    return Dockerlogs;
}());
exports.Dockerlogs = Dockerlogs;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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TixDQUFDO1FBR0QsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUVkLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztRQUVSLENBQUM7UUFJRCxXQUFXLENBQUM7WUFDUixJQUFJLEVBQUUsQ0FBQTtRQUNWLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUVSLElBQUksRUFBRSxDQUFBO0lBRVYsQ0FBQztJQUdMLGlCQUFDO0FBQUQsQ0E1RUEsQUE0RUMsSUFBQTtBQTVFWSxnQ0FBVSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFByb21pc2UgZnJvbSBcImJsdWViaXJkXCI7XG5cblxuaW1wb3J0IHsgZXhlYywgZXhlY1N5bmMgfSBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiXG5pbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIlxuXG5pbXBvcnQgeyBJRG9ja2VyIH0gZnJvbSBcIi4vZG9ja2VydHlwZWRcIlxuXG5cbmludGVyZmFjZSBJRG9ja2VyQ29uZiB7XG5cbn1cblxuaW50ZXJmYWNlIElkYXRhT3B0IHtcblxufVxuXG5pbnRlcmZhY2UgSXN0cmVhbU9wdCB7XG5cbn1cblxuXG5cbmludGVyZmFjZSBJTG9nU3RhY2sge1xuICAgIGxhYmVsOiBzdHJpbmdcbiAgICBjb250YWluZXJzOiBJRG9ja2VyW11cbn1cblxuaW50ZXJmYWNlIElMb2dzIHtcblxuICAgIGNvbnRhaW5lcnM6IElEb2NrZXJbXVxuICAgIHN0YWNrczogSUxvZ1N0YWNrW11cblxufVxuXG5mdW5jdGlvbiBjaGVja3N0YWNrKGhvc3ROb2RlczogSURvY2tlcltdKTogSUxvZ1N0YWNrW10ge1xuXG5cbiAgICBjb25zdCBzdGFja3M6IElMb2dTdGFja1tdID0gW107XG4gICAgXy5tYXAoaG9zdE5vZGVzLCBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG5cblxuICAgICAgICBjb25zdCBjb21wb3NlX2xhYmVsID0gY29udGFpbmVyLkNvbmZpZy5MYWJlbHNbXCJjb20uZG9ja2VyLmNvbXBvc2UucHJvamVjdFwiXTtcblxuXG4gICAgICAgIGxldCBleGlzdHMgPSBmYWxzZTtcbiAgICAgICAgXy5tYXAoc3RhY2tzLCBmdW5jdGlvbiAoc3RhY2spIHtcbiAgICAgICAgICAgIGlmIChjb21wb3NlX2xhYmVsID09PSBzdGFjay5sYWJlbCkge1xuICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7XG4gICAgICAgICAgICAgICAgc3RhY2suY29udGFpbmVycy5wdXNoKGNvbnRhaW5lcilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICBpZiAoIWV4aXN0cykge1xuICAgICAgICAgICAgc3RhY2tzLnB1c2goeyBsYWJlbDogY29tcG9zZV9sYWJlbCwgY29udGFpbmVyczogW2NvbnRhaW5lcl0gfSlcbiAgICAgICAgfVxuXG4gICAgfSlcblxuICAgIHJldHVybiBzdGFja3Ncbn1cblxuXG5mdW5jdGlvbiBnZXREYXRhKCkge1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlPElMb2dzPihmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGV4ZWMoXCJkb2NrZXIgcHMgfCBncmVwIC1jICcnXCIsIGZ1bmN0aW9uIChlcnIsIHN0ZG91dCwgc3RkZXJyKSB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycilcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Rkb3V0ICYmIHBhcnNlSW50KHN0ZG91dCkgJiYgcGFyc2VJbnQoc3Rkb3V0KSA+IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwYXJzZUludChzdGRvdXQpKVxuICAgICAgICAgICAgICAgIGV4ZWMoXCJkb2NrZXIgaW5zcGVjdCAkKGRvY2tlciBwcyB8IGF3ayAne3ByaW50JDF9J3xncmVwIC12IENPTlRBSU5FUilcIiwgZnVuY3Rpb24gKGVyciwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0ZG91dCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBEb2NrZXJDb250YWluZXJzOiBJRG9ja2VyW10gPSBKU09OLnBhcnNlKHN0ZG91dClcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcnM6IERvY2tlckNvbnRhaW5lcnMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrczogY2hlY2tzdGFjayhEb2NrZXJDb250YWluZXJzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KFwibWFsZm9ybWVkIGpzb24gZG9ja2VyIGxvZ3NcIilcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN0ZG91dCAmJiBwYXJzZUludChzdGRvdXQpICYmIHBhcnNlSW50KHN0ZG91dCkgPT09IDEpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrczogW11cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICByZWplY3QoXCJtYWxmb3JtZWQgYW5zd2VyXCIpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSlcbiAgICB9KVxufVxuXG5leHBvcnQgY2xhc3MgRG9ja2VybG9ncyB7XG5cbiAgICBvcHRpb25zOiBJRG9ja2VyQ29uZlxuICAgIGRvY2tlclZlcnNpb246IHN0cmluZ1xuICAgIGNvbXBvc2VWZXJzaW9uOiBzdHJpbmdcbiAgICBhcGlWZXJzaW9uOiBzdHJpbmdcbiAgICBzdGFja3M6IHt9XG5cbiAgICBjb25zdHJ1Y3Rvcihjb25mPzogSURvY2tlckNvbmYpIHtcbiAgICAgICAgdGhpcy5hcGlWZXJzaW9uID0gcmVxdWlyZShcIi4vcGFja2FnZS5qc29uXCIpLnZlcnNpb247XG4gICAgICAgIHRoaXMuZG9ja2VyVmVyc2lvbiA9IGV4ZWNTeW5jKFwiZG9ja2VyIC12IHwgZ3JlcCB2ZXJzaW9uIHwgYXdrICd7cHJpbnQkM30nIHwgc2VkICdzLywvL2cnXCIpLnRvU3RyaW5nKFwidXRmLThcIikucmVwbGFjZSgnXFxuJywgJycpXG5cbiAgICAgICAgdGhpcy5jb21wb3NlVmVyc2lvbiA9IGV4ZWNTeW5jKFwiZG9ja2VyLWNvbXBvc2UgLXYgfCBncmVwIGNvbXBvc2UgfCBhd2sgJ3twcmludCQzfScgfCBzZWQgJ3MvLC8vZydcIikudG9TdHJpbmcoXCJ1dGYtOFwiKS5yZXBsYWNlKCdcXG4nLCAnJylcblxuXG4gICAgICAgIGNvbnN0IGNvbmZpZ3VyYXRpb246IElEb2NrZXJDb25mID0ge1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmYpIHtcblxuICAgICAgICAgICAgT2JqZWN0Wydhc3NpZ24nXShjb25maWd1cmF0aW9uLCBjb25mKVxuXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBjb25maWd1cmF0aW9uXG5cbiAgICB9XG5cbiAgICBkYXRhKG9wdGlvbnM/OiBJZGF0YU9wdCkge1xuXG5cbiAgICAgICAgbGV0IG9wdFxuXG4gICAgICAgIGlmIChvcHRpb25zKSB7XG5cblxuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgfVxuXG5cblxuICAgICAgICByZXR1cm4gZ2V0RGF0YSgpXG5cbiAgICB9XG5cbiAgICBzdHJlYW0oY2IsIG9wdGlvbnM/OiBJc3RyZWFtT3B0KSB7XG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzXG5cbiAgICAgICAgZnVuY3Rpb24gZG9pdCgpIHtcbiAgICAgICAgICAgIHRoYXQuZGF0YSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgIGNiKGRhdGEpXG5cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuXG4gICAgICAgIGlmIChvcHRpb25zKSB7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICB9XG5cblxuXG4gICAgICAgIHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgIGRvaXQoKVxuICAgICAgICB9LCA1MDAwKVxuXG4gICAgICAgIGRvaXQoKVxuXG4gICAgfVxuXG5cbn1cblxuXG5cblxuIl19
