"use strict";
var Promise = require("bluebird");
var child_process = require("child_process");
var _ = require("lodash");
var execSync = child_process.execSync;
var exec = child_process.exec;
function checkstack(hostNodes) {
    var stacks = [];
    _.map(hostNodes, function (container) {
        var compose_label = container.Config.Labels["com.docker.compose.project"];
        var exists = false;
        _.map(stacks, function (stack) {
            if (compose_label === stack.label) {
                exists = true;
                stack.containers.push(container);
            }
        });
        if (!exists) {
            stacks.push({ label: compose_label, containers: [container] });
        }
    });
    return stacks;
}
function getData(opt) {
    return new Promise(function (resolve, reject) {
        exec("docker ps | grep -c ''", function (err, stdout, stderr) {
            if (err) {
                reject(err);
            }
            else if (stdout && parseInt(stdout) && parseInt(stdout) > 1) {
                console.log(parseInt(stdout));
                exec("docker inspect $(docker ps | awk '{print$1}'|grep -v CONTAINER)", function (err, stdout, stderr) {
                    if (err) {
                        console.log(err);
                    }
                    else if (stdout) {
                        var obj = {
                            containers: JSON.parse(stdout),
                            stacks: checkstack(JSON.parse(stdout))
                        };
                        resolve(obj);
                    }
                    else {
                        reject("malformed json docker logs");
                    }
                });
            }
            else if (stdout && parseInt(stdout) && parseInt(stdout) === 1) {
                resolve([]);
            }
            else {
                reject("malformed answer");
            }
        });
    });
}
var Docker = (function () {
    function Docker(conf) {
        this.apiVersion = require("./package.json").version;
        this.dockerVersion = execSync("docker -v | grep version | awk '{print$3}' | sed 's/,//g'").toString("utf-8").replace('\n', '');
        this.composeVersion = execSync("docker-compose -v | grep compose | awk '{print$3}' | sed 's/,//g'").toString("utf-8").replace('\n', '');
        var configuration = {};
        if (conf) {
            Object['assign'](configuration, conf);
        }
        this.options = configuration;
    }
    Docker.prototype.data = function (options) {
        var opt;
        if (options) {
        }
        else {
        }
        return getData(opt);
    };
    Docker.prototype.stream = function (cb, options) {
        var that = this;
        function doit() {
            that.data().then(function (data) {
                cb(data);
            });
        }
        if (options) {
        }
        else {
        }
        setInterval(function () {
            doit();
        }, 5000);
        doit();
    };
    return Docker;
}());
module.exports = Docker;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LElBQUksQ0FBQyxVQUFVLElBQUk7Z0JBRTNCLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtZQUVaLENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQUdELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFFZCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7UUFFUixDQUFDO1FBSUQsV0FBVyxDQUFDO1lBQ1IsSUFBSSxFQUFFLENBQUE7UUFDVixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFFUixJQUFJLEVBQUUsQ0FBQTtJQUVWLENBQUM7SUFHTCxhQUFDO0FBQUQsQ0E3RUEsQUE2RUMsSUFBQTtBQUdELGlCQUFTLE1BQU0sQ0FBQSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFByb21pc2UgZnJvbSBcImJsdWViaXJkXCI7XG5cblxuaW1wb3J0ICogYXMgY2hpbGRfcHJvY2VzcyBmcm9tIFwiY2hpbGRfcHJvY2Vzc1wiXG5pbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIlxuXG5sZXQgZXhlY1N5bmMgPSBjaGlsZF9wcm9jZXNzLmV4ZWNTeW5jO1xubGV0IGV4ZWMgPSBjaGlsZF9wcm9jZXNzLmV4ZWM7XG5cbmludGVyZmFjZSBJRG9ja2VyQ29uZiB7XG5cbn1cblxuaW50ZXJmYWNlIElkYXRhT3B0IHtcblxufVxuXG5pbnRlcmZhY2UgSXN0cmVhbU9wdCB7XG5cbn1cblxuXG5cbmZ1bmN0aW9uIGNoZWNrc3RhY2soaG9zdE5vZGVzKSB7XG5cblxuICAgIGNvbnN0IHN0YWNrcyA9IFtdO1xuICAgIF8ubWFwKGhvc3ROb2RlcywgZnVuY3Rpb24gKGNvbnRhaW5lcjogYW55KSB7XG5cblxuICAgICAgICB2YXIgY29tcG9zZV9sYWJlbCA9IGNvbnRhaW5lci5Db25maWcuTGFiZWxzW1wiY29tLmRvY2tlci5jb21wb3NlLnByb2plY3RcIl07XG5cblxuICAgICAgICB2YXIgZXhpc3RzID0gZmFsc2U7XG4gICAgICAgIF8ubWFwKHN0YWNrcywgZnVuY3Rpb24gKHN0YWNrKSB7XG4gICAgICAgICAgICBpZiAoY29tcG9zZV9sYWJlbCA9PT0gc3RhY2subGFiZWwpIHtcbiAgICAgICAgICAgICAgICBleGlzdHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHN0YWNrLmNvbnRhaW5lcnMucHVzaChjb250YWluZXIpXG4gICAgICAgICAgICB9XG5cblxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgaWYgKCFleGlzdHMpIHtcbiAgICAgICAgICAgIHN0YWNrcy5wdXNoKHsgbGFiZWw6IGNvbXBvc2VfbGFiZWwsIGNvbnRhaW5lcnM6IFtjb250YWluZXJdIH0pXG5cblxuICAgICAgICB9XG5cblxuXG5cbiAgICB9KVxuXG5cblxuXG5cblxuXG5cblxuICAgIHJldHVybiBzdGFja3Ncbn1cblxuXG5mdW5jdGlvbiBnZXREYXRhKG9wdCkge1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZXhlYyhcImRvY2tlciBwcyB8IGdyZXAgLWMgJydcIiwgZnVuY3Rpb24gKGVyciwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGRvdXQgJiYgcGFyc2VJbnQoc3Rkb3V0KSAmJiBwYXJzZUludChzdGRvdXQpID4gMSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHBhcnNlSW50KHN0ZG91dCkpXG4gICAgICAgICAgICAgICAgZXhlYyhcImRvY2tlciBpbnNwZWN0ICQoZG9ja2VyIHBzIHwgYXdrICd7cHJpbnQkMX0nfGdyZXAgLXYgQ09OVEFJTkVSKVwiLCBmdW5jdGlvbiAoZXJyLCBzdGRvdXQsIHN0ZGVycikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Rkb3V0KSB7XG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2JqID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcnM6IEpTT04ucGFyc2Uoc3Rkb3V0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja3M6IGNoZWNrc3RhY2soSlNPTi5wYXJzZShzdGRvdXQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG9iaik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChcIm1hbGZvcm1lZCBqc29uIGRvY2tlciBsb2dzXCIpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGRvdXQgJiYgcGFyc2VJbnQoc3Rkb3V0KSAmJiBwYXJzZUludChzdGRvdXQpID09PSAxKSB7XG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShbXSk7XG5cblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIHJlamVjdChcIm1hbGZvcm1lZCBhbnN3ZXJcIilcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KVxuICAgIH0pXG59XG5cbmNsYXNzIERvY2tlciB7XG5cbiAgICBvcHRpb25zOiBJRG9ja2VyQ29uZlxuICAgIGRvY2tlclZlcnNpb246IHN0cmluZztcbiAgICBjb21wb3NlVmVyc2lvbjogc3RyaW5nO1xuICAgIGFwaVZlcnNpb246IHN0cmluZztcbiAgICBzdGFja3M6IHt9O1xuXG4gICAgY29uc3RydWN0b3IoY29uZj86IElEb2NrZXJDb25mKSB7XG4gICAgICAgIHRoaXMuYXBpVmVyc2lvbiA9IHJlcXVpcmUoXCIuL3BhY2thZ2UuanNvblwiKS52ZXJzaW9uO1xuICAgICAgICB0aGlzLmRvY2tlclZlcnNpb24gPSBleGVjU3luYyhcImRvY2tlciAtdiB8IGdyZXAgdmVyc2lvbiB8IGF3ayAne3ByaW50JDN9JyB8IHNlZCAncy8sLy9nJ1wiKS50b1N0cmluZyhcInV0Zi04XCIpLnJlcGxhY2UoJ1xcbicsICcnKTtcblxuICAgICAgICB0aGlzLmNvbXBvc2VWZXJzaW9uID0gZXhlY1N5bmMoXCJkb2NrZXItY29tcG9zZSAtdiB8IGdyZXAgY29tcG9zZSB8IGF3ayAne3ByaW50JDN9JyB8IHNlZCAncy8sLy9nJ1wiKS50b1N0cmluZyhcInV0Zi04XCIpLnJlcGxhY2UoJ1xcbicsICcnKTtcblxuXG4gICAgICAgIGxldCBjb25maWd1cmF0aW9uOiBJRG9ja2VyQ29uZiA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChjb25mKSB7XG5cbiAgICAgICAgICAgIE9iamVjdFsnYXNzaWduJ10oY29uZmlndXJhdGlvbiwgY29uZik7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IGNvbmZpZ3VyYXRpb247XG5cbiAgICB9XG5cbiAgICBkYXRhKG9wdGlvbnM/OiBJZGF0YU9wdCkge1xuXG5cbiAgICAgICAgbGV0IG9wdDtcblxuICAgICAgICBpZiAob3B0aW9ucykge1xuXG5cblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgIH1cblxuXG5cbiAgICAgICAgcmV0dXJuIGdldERhdGEob3B0KTtcblxuICAgIH1cblxuICAgIHN0cmVhbShjYiwgb3B0aW9ucz86IElzdHJlYW1PcHQpIHtcbiAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgZnVuY3Rpb24gZG9pdCgpIHtcbiAgICAgICAgICAgIHRoYXQuZGF0YSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgIGNiKGRhdGEpXG5cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuXG4gICAgICAgIGlmIChvcHRpb25zKSB7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICB9XG5cblxuXG4gICAgICAgIHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgIGRvaXQoKVxuICAgICAgICB9LCA1MDAwKVxuXG4gICAgICAgIGRvaXQoKVxuXG4gICAgfVxuXG5cbn1cblxuXG5leHBvcnQgPSBEb2NrZXJcblxuIl19
