"use strict";
var Promise = require("bluebird");
var child_process_1 = require("child_process");
var _ = require("lodash");
function checkstack(hostNodes) {
    var stacks = [];
    _.map(hostNodes, function (container) {
        var compose_label = container.Config.Labels["com.docker.compose.project"];
        var exists = false;
        _.map(stacks, function (stack) {
            if (compose_label === stack.label) {
                exists = true;
                stack.containers.push(container);
            }
        });
        if (!exists) {
            stacks.push({ label: compose_label, containers: [container] });
        }
    });
    return stacks;
}
function getData() {
    return new Promise(function (resolve, reject) {
        child_process_1.exec("docker ps | grep -c ''", function (err, stdout, stderr) {
            if (err) {
                reject(err);
            }
            else if (stdout && parseInt(stdout) && parseInt(stdout) > 1) {
                console.log(parseInt(stdout));
                child_process_1.exec("docker inspect $(docker ps | awk '{print$1}'|grep -v CONTAINER)", function (err, stdout, stderr) {
                    if (err) {
                        console.log(err);
                    }
                    else if (stdout) {
                        var DockerContainers = JSON.parse(stdout);
                        var obj = {
                            containers: DockerContainers,
                            stacks: checkstack(DockerContainers)
                        };
                        resolve(obj);
                    }
                    else {
                        reject("malformed json docker logs");
                    }
                });
            }
            else if (stdout && parseInt(stdout) && parseInt(stdout) === 1) {
                var obj = {
                    containers: [],
                    stacks: []
                };
                resolve(obj);
            }
            else {
                reject("malformed answer");
            }
        });
    });
}
var Dockerlogs = (function () {
    function Dockerlogs(conf) {
        this.apiVersion = require("./package.json").version;
        this.dockerVersion = child_process_1.execSync("docker -v | grep version | awk '{print$3}' | sed 's/,//g'").toString("utf-8").replace('\n', '');
        this.composeVersion = child_process_1.execSync("docker-compose -v | grep compose | awk '{print$3}' | sed 's/,//g'").toString("utf-8").replace('\n', '');
        var configuration = {};
        if (conf) {
            Object['assign'](configuration, conf);
        }
        this.options = configuration;
    }
    Dockerlogs.prototype.data = function (options) {
        var opt;
        if (options) {
        }
        else {
        }
        return getData();
    };
    Dockerlogs.prototype.stream = function (cb, options) {
        var that = this;
        function doit() {
            that.data().then(function (data) {
                cb(data);
            });
        }
        if (options) {
        }
        else {
        }
        setInterval(function () {
            doit();
        }, 5000);
        doit();
    };
    return Dockerlogs;
}());
exports.Dockerlogs = Dockerlogs;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFVLElBQUk7Z0JBRTNCLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtZQUVaLENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQUdELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFFZCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7UUFFUixDQUFDO1FBSUQsV0FBVyxDQUFDO1lBQ1IsSUFBSSxFQUFFLENBQUE7UUFDVixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFFUixJQUFJLEVBQUUsQ0FBQTtJQUVWLENBQUM7SUFHTCxpQkFBQztBQUFELENBNUVBLEFBNEVDLElBQUE7QUE1RVksZ0NBQVUiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gXCJibHVlYmlyZFwiO1xuXG5cbmltcG9ydCB7IGV4ZWMsIGV4ZWNTeW5jIH0gZnJvbSBcImNoaWxkX3Byb2Nlc3NcIlxuaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCJcblxuaW1wb3J0IHsgSURvY2tlciB9IGZyb20gXCIuL2RvY2tlcnR5cGVkXCJcblxuXG5pbnRlcmZhY2UgSURvY2tlckNvbmYge1xuXG59XG5cbmludGVyZmFjZSBJZGF0YU9wdCB7XG5cbn1cblxuaW50ZXJmYWNlIElzdHJlYW1PcHQge1xuXG59XG5cblxuXG5pbnRlcmZhY2UgSUxvZ1N0YWNrIHtcbiAgICBsYWJlbDogc3RyaW5nO1xuICAgIGNvbnRhaW5lcnM6IElEb2NrZXJbXVxufVxuXG5pbnRlcmZhY2UgSUxvZ3Mge1xuXG4gICAgY29udGFpbmVyczogSURvY2tlcltdXG4gICAgc3RhY2tzOiBJTG9nU3RhY2tbXVxuXG59XG5cbmZ1bmN0aW9uIGNoZWNrc3RhY2soaG9zdE5vZGVzOiBJRG9ja2VyW10pOiBJTG9nU3RhY2tbXSB7XG5cblxuICAgIGNvbnN0IHN0YWNrczogSUxvZ1N0YWNrW10gPSBbXTtcbiAgICBfLm1hcChob3N0Tm9kZXMsIGZ1bmN0aW9uIChjb250YWluZXIpIHtcblxuXG4gICAgICAgIGNvbnN0IGNvbXBvc2VfbGFiZWwgPSBjb250YWluZXIuQ29uZmlnLkxhYmVsc1tcImNvbS5kb2NrZXIuY29tcG9zZS5wcm9qZWN0XCJdO1xuXG5cbiAgICAgICAgbGV0IGV4aXN0cyA9IGZhbHNlO1xuICAgICAgICBfLm1hcChzdGFja3MsIGZ1bmN0aW9uIChzdGFjaykge1xuICAgICAgICAgICAgaWYgKGNvbXBvc2VfbGFiZWwgPT09IHN0YWNrLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgZXhpc3RzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzdGFjay5jb250YWluZXJzLnB1c2goY29udGFpbmVyKVxuICAgICAgICAgICAgfVxuXG5cblxuICAgICAgICB9KVxuXG4gICAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgICAgICBzdGFja3MucHVzaCh7IGxhYmVsOiBjb21wb3NlX2xhYmVsLCBjb250YWluZXJzOiBbY29udGFpbmVyXSB9KVxuICAgICAgICB9XG5cblxuXG5cbiAgICB9KVxuXG4gICAgcmV0dXJuIHN0YWNrc1xufVxuXG5cbmZ1bmN0aW9uIGdldERhdGEoKSB7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2U8SUxvZ3M+KGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgZXhlYyhcImRvY2tlciBwcyB8IGdyZXAgLWMgJydcIiwgZnVuY3Rpb24gKGVyciwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgfSBlbHNlIGlmIChzdGRvdXQgJiYgcGFyc2VJbnQoc3Rkb3V0KSAmJiBwYXJzZUludChzdGRvdXQpID4gMSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHBhcnNlSW50KHN0ZG91dCkpXG4gICAgICAgICAgICAgICAgZXhlYyhcImRvY2tlciBpbnNwZWN0ICQoZG9ja2VyIHBzIHwgYXdrICd7cHJpbnQkMX0nfGdyZXAgLXYgQ09OVEFJTkVSKVwiLCBmdW5jdGlvbiAoZXJyLCBzdGRvdXQsIHN0ZGVycikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Rkb3V0KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IERvY2tlckNvbnRhaW5lcnM6IElEb2NrZXJbXSA9IEpTT04ucGFyc2Uoc3Rkb3V0KVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvYmogPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyczogRG9ja2VyQ29udGFpbmVycyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja3M6IGNoZWNrc3RhY2soRG9ja2VyQ29udGFpbmVycylcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJtYWxmb3JtZWQganNvbiBkb2NrZXIgbG9nc1wiKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Rkb3V0ICYmIHBhcnNlSW50KHN0ZG91dCkgJiYgcGFyc2VJbnQoc3Rkb3V0KSA9PT0gMSkge1xuXG4gICAgICAgICAgICAgICAgY29uc3Qgb2JqID0ge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluZXJzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgc3RhY2tzOiBbXVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcblxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgcmVqZWN0KFwibWFsZm9ybWVkIGFuc3dlclwiKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pXG4gICAgfSlcbn1cblxuZXhwb3J0IGNsYXNzIERvY2tlcmxvZ3Mge1xuXG4gICAgb3B0aW9uczogSURvY2tlckNvbmZcbiAgICBkb2NrZXJWZXJzaW9uOiBzdHJpbmc7XG4gICAgY29tcG9zZVZlcnNpb246IHN0cmluZztcbiAgICBhcGlWZXJzaW9uOiBzdHJpbmc7XG4gICAgc3RhY2tzOiB7fTtcblxuICAgIGNvbnN0cnVjdG9yKGNvbmY/OiBJRG9ja2VyQ29uZikge1xuICAgICAgICB0aGlzLmFwaVZlcnNpb24gPSByZXF1aXJlKFwiLi9wYWNrYWdlLmpzb25cIikudmVyc2lvbjtcbiAgICAgICAgdGhpcy5kb2NrZXJWZXJzaW9uID0gZXhlY1N5bmMoXCJkb2NrZXIgLXYgfCBncmVwIHZlcnNpb24gfCBhd2sgJ3twcmludCQzfScgfCBzZWQgJ3MvLC8vZydcIikudG9TdHJpbmcoXCJ1dGYtOFwiKS5yZXBsYWNlKCdcXG4nLCAnJyk7XG5cbiAgICAgICAgdGhpcy5jb21wb3NlVmVyc2lvbiA9IGV4ZWNTeW5jKFwiZG9ja2VyLWNvbXBvc2UgLXYgfCBncmVwIGNvbXBvc2UgfCBhd2sgJ3twcmludCQzfScgfCBzZWQgJ3MvLC8vZydcIikudG9TdHJpbmcoXCJ1dGYtOFwiKS5yZXBsYWNlKCdcXG4nLCAnJyk7XG5cblxuICAgICAgICBjb25zdCBjb25maWd1cmF0aW9uOiBJRG9ja2VyQ29uZiA9IHtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoY29uZikge1xuXG4gICAgICAgICAgICBPYmplY3RbJ2Fzc2lnbiddKGNvbmZpZ3VyYXRpb24sIGNvbmYpO1xuXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBjb25maWd1cmF0aW9uO1xuXG4gICAgfVxuXG4gICAgZGF0YShvcHRpb25zPzogSWRhdGFPcHQpIHtcblxuXG4gICAgICAgIGxldCBvcHQ7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMpIHtcblxuXG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICB9XG5cblxuXG4gICAgICAgIHJldHVybiBnZXREYXRhKCk7XG5cbiAgICB9XG5cbiAgICBzdHJlYW0oY2IsIG9wdGlvbnM/OiBJc3RyZWFtT3B0KSB7XG4gICAgICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xuXG4gICAgICAgIGZ1bmN0aW9uIGRvaXQoKSB7XG4gICAgICAgICAgICB0aGF0LmRhdGEoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBjYihkYXRhKVxuXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cblxuICAgICAgICBpZiAob3B0aW9ucykge1xuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgfVxuXG5cblxuICAgICAgICBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICBkb2l0KClcbiAgICAgICAgfSwgNTAwMClcblxuICAgICAgICBkb2l0KClcblxuICAgIH1cblxuXG59XG5cblxuXG5cbiJdfQ==
