"use strict";
var Promise = require("bluebird");
var child_process = require("child_process");
var _ = require("lodash");
var execSync = child_process.execSync;
var exec = child_process.exec;
function checkstack(hostNodes) {
    var stacks = [];
    _.map(hostNodes, function (container) {
        var compose_label = container.Config.Labels["com.docker.compose.project"];
        var exists = false;
        _.map(stacks, function (stack) {
            if (compose_label === stack.label) {
                exists = true;
                stack.containers.push(container);
            }
        });
        if (!exists) {
            stacks.push({ label: compose_label, containers: [container] });
        }
    });
    return stacks;
}
function getData(opt) {
    return new Promise(function (resolve, reject) {
        exec("docker ps | grep -c ''", function (err, stdout, stderr) {
            if (err) {
                reject(err);
            }
            else if (stdout && parseInt(stdout) && parseInt(stdout) > 1) {
                console.log(parseInt(stdout));
                exec("docker inspect $(docker ps | awk '{print$1}'|grep -v CONTAINER)", function (err, stdout, stderr) {
                    if (err) {
                        console.log(err);
                    }
                    else if (stdout) {
                        var obj = {
                            containers: JSON.parse(stdout),
                            stacks: checkstack(JSON.parse(stdout))
                        };
                        resolve(obj);
                    }
                    else {
                        reject("malformed json docker logs");
                    }
                });
            }
            else if (stdout && parseInt(stdout) && parseInt(stdout) === 1) {
                resolve([]);
            }
            else {
                reject("malformed answer");
            }
        });
    });
}
var Dockerlogs = (function () {
    function Dockerlogs(conf) {
        this.apiVersion = require("./package.json").version;
        this.dockerVersion = execSync("docker -v | grep version | awk '{print$3}' | sed 's/,//g'").toString("utf-8").replace('\n', '');
        this.composeVersion = execSync("docker-compose -v | grep compose | awk '{print$3}' | sed 's/,//g'").toString("utf-8").replace('\n', '');
        var configuration = {};
        if (conf) {
            Object['assign'](configuration, conf);
        }
        this.options = configuration;
    }
    Dockerlogs.prototype.data = function (options) {
        var opt;
        if (options) {
        }
        else {
        }
        return getData(opt);
    };
    Dockerlogs.prototype.stream = function (cb, options) {
        var that = this;
        function doit() {
            that.data().then(function (data) {
                cb(data);
            });
        }
        if (options) {
        }
        else {
        }
        setInterval(function () {
            doit();
        }, 5000);
        doit();
    };
    return Dockerlogs;
}());
exports.Dockerlogs = Dockerlogs;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LElBQUksQ0FBQyxVQUFVLElBQUk7Z0JBRTNCLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQTtZQUVaLENBQUMsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQUdELEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFFZCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7UUFFUixDQUFDO1FBSUQsV0FBVyxDQUFDO1lBQ1IsSUFBSSxFQUFFLENBQUE7UUFDVixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUE7UUFFUixJQUFJLEVBQUUsQ0FBQTtJQUVWLENBQUM7SUFHTCxpQkFBQztBQUFELENBN0VBLEFBNkVDLElBQUE7QUE3RVksZ0NBQVUiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gXCJibHVlYmlyZFwiO1xuXG5cbmltcG9ydCAqIGFzIGNoaWxkX3Byb2Nlc3MgZnJvbSBcImNoaWxkX3Byb2Nlc3NcIlxuaW1wb3J0ICogYXMgXyBmcm9tIFwibG9kYXNoXCJcblxubGV0IGV4ZWNTeW5jID0gY2hpbGRfcHJvY2Vzcy5leGVjU3luYztcbmxldCBleGVjID0gY2hpbGRfcHJvY2Vzcy5leGVjO1xuXG5pbnRlcmZhY2UgSURvY2tlckNvbmYge1xuXG59XG5cbmludGVyZmFjZSBJZGF0YU9wdCB7XG5cbn1cblxuaW50ZXJmYWNlIElzdHJlYW1PcHQge1xuXG59XG5cblxuXG5mdW5jdGlvbiBjaGVja3N0YWNrKGhvc3ROb2Rlcykge1xuXG5cbiAgICBjb25zdCBzdGFja3MgPSBbXTtcbiAgICBfLm1hcChob3N0Tm9kZXMsIGZ1bmN0aW9uIChjb250YWluZXI6IGFueSkge1xuXG5cbiAgICAgICAgdmFyIGNvbXBvc2VfbGFiZWwgPSBjb250YWluZXIuQ29uZmlnLkxhYmVsc1tcImNvbS5kb2NrZXIuY29tcG9zZS5wcm9qZWN0XCJdO1xuXG5cbiAgICAgICAgdmFyIGV4aXN0cyA9IGZhbHNlO1xuICAgICAgICBfLm1hcChzdGFja3MsIGZ1bmN0aW9uIChzdGFjaykge1xuICAgICAgICAgICAgaWYgKGNvbXBvc2VfbGFiZWwgPT09IHN0YWNrLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgZXhpc3RzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzdGFjay5jb250YWluZXJzLnB1c2goY29udGFpbmVyKVxuICAgICAgICAgICAgfVxuXG5cblxuICAgICAgICB9KVxuXG4gICAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgICAgICBzdGFja3MucHVzaCh7IGxhYmVsOiBjb21wb3NlX2xhYmVsLCBjb250YWluZXJzOiBbY29udGFpbmVyXSB9KVxuXG5cbiAgICAgICAgfVxuXG5cblxuXG4gICAgfSlcblxuXG5cblxuXG5cblxuXG5cbiAgICByZXR1cm4gc3RhY2tzXG59XG5cblxuZnVuY3Rpb24gZ2V0RGF0YShvcHQpIHtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgIGV4ZWMoXCJkb2NrZXIgcHMgfCBncmVwIC1jICcnXCIsIGZ1bmN0aW9uIChlcnIsIHN0ZG91dCwgc3RkZXJyKSB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycilcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Rkb3V0ICYmIHBhcnNlSW50KHN0ZG91dCkgJiYgcGFyc2VJbnQoc3Rkb3V0KSA+IDEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwYXJzZUludChzdGRvdXQpKVxuICAgICAgICAgICAgICAgIGV4ZWMoXCJkb2NrZXIgaW5zcGVjdCAkKGRvY2tlciBwcyB8IGF3ayAne3ByaW50JDF9J3xncmVwIC12IENPTlRBSU5FUilcIiwgZnVuY3Rpb24gKGVyciwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0ZG91dCkge1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9iaiA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250YWluZXJzOiBKU09OLnBhcnNlKHN0ZG91dCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tzOiBjaGVja3N0YWNrKEpTT04ucGFyc2Uoc3Rkb3V0KSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoXCJtYWxmb3JtZWQganNvbiBkb2NrZXIgbG9nc1wiKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Rkb3V0ICYmIHBhcnNlSW50KHN0ZG91dCkgJiYgcGFyc2VJbnQoc3Rkb3V0KSA9PT0gMSkge1xuXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoW10pO1xuXG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICByZWplY3QoXCJtYWxmb3JtZWQgYW5zd2VyXCIpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSlcbiAgICB9KVxufVxuXG5leHBvcnQgY2xhc3MgRG9ja2VybG9ncyB7XG5cbiAgICBvcHRpb25zOiBJRG9ja2VyQ29uZlxuICAgIGRvY2tlclZlcnNpb246IHN0cmluZztcbiAgICBjb21wb3NlVmVyc2lvbjogc3RyaW5nO1xuICAgIGFwaVZlcnNpb246IHN0cmluZztcbiAgICBzdGFja3M6IHt9O1xuXG4gICAgY29uc3RydWN0b3IoY29uZj86IElEb2NrZXJDb25mKSB7XG4gICAgICAgIHRoaXMuYXBpVmVyc2lvbiA9IHJlcXVpcmUoXCIuL3BhY2thZ2UuanNvblwiKS52ZXJzaW9uO1xuICAgICAgICB0aGlzLmRvY2tlclZlcnNpb24gPSBleGVjU3luYyhcImRvY2tlciAtdiB8IGdyZXAgdmVyc2lvbiB8IGF3ayAne3ByaW50JDN9JyB8IHNlZCAncy8sLy9nJ1wiKS50b1N0cmluZyhcInV0Zi04XCIpLnJlcGxhY2UoJ1xcbicsICcnKTtcblxuICAgICAgICB0aGlzLmNvbXBvc2VWZXJzaW9uID0gZXhlY1N5bmMoXCJkb2NrZXItY29tcG9zZSAtdiB8IGdyZXAgY29tcG9zZSB8IGF3ayAne3ByaW50JDN9JyB8IHNlZCAncy8sLy9nJ1wiKS50b1N0cmluZyhcInV0Zi04XCIpLnJlcGxhY2UoJ1xcbicsICcnKTtcblxuXG4gICAgICAgIGxldCBjb25maWd1cmF0aW9uOiBJRG9ja2VyQ29uZiA9IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChjb25mKSB7XG5cbiAgICAgICAgICAgIE9iamVjdFsnYXNzaWduJ10oY29uZmlndXJhdGlvbiwgY29uZik7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IGNvbmZpZ3VyYXRpb247XG5cbiAgICB9XG5cbiAgICBkYXRhKG9wdGlvbnM/OiBJZGF0YU9wdCkge1xuXG5cbiAgICAgICAgbGV0IG9wdDtcblxuICAgICAgICBpZiAob3B0aW9ucykge1xuXG5cblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgIH1cblxuXG5cbiAgICAgICAgcmV0dXJuIGdldERhdGEob3B0KTtcblxuICAgIH1cblxuICAgIHN0cmVhbShjYiwgb3B0aW9ucz86IElzdHJlYW1PcHQpIHtcbiAgICAgICAgY29uc3QgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgZnVuY3Rpb24gZG9pdCgpIHtcbiAgICAgICAgICAgIHRoYXQuZGF0YSgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICAgICAgICAgICAgIGNiKGRhdGEpXG5cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuXG4gICAgICAgIGlmIChvcHRpb25zKSB7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICB9XG5cblxuXG4gICAgICAgIHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgIGRvaXQoKVxuICAgICAgICB9LCA1MDAwKVxuXG4gICAgICAgIGRvaXQoKVxuXG4gICAgfVxuXG5cbn1cblxuXG5cblxuIl19
